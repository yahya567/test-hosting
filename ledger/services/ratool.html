<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Risk_Assessment_Tool_v2 ‚Äî QHSE Solutions.kz</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  :root{
    --bg:#ffffff;
    --card:#f8f9fa;
    --accent:#0b4db6; /* —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç */
    --accent-2:#06386e;
    --muted:#6c757d;
    --low:#4caf50;    /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –∑–µ–ª—ë–Ω—ã–π */
    --medium:#ff9800; /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
    --high:#f44336;   /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π */
    --panel:#e9ecef;
    --btn-success:#4caf50; /* –ó–µ–ª—ë–Ω—ã–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    --btn-text:#000000; /* –ß—ë—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö */
  }
  *{box-sizing:border-box;font-family:Inter,Segoe UI,Arial;margin:0;padding:0}
  body{background:var(--bg);color:#212529;padding:18px}
  .wrap{max-width:1400px;margin:0 auto}
  header{display:flex;align-items:flex-start;gap:18px;margin-bottom:14px}
  h1{font-size:20px;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .subtitle{color:var(--muted);font-size:13px}
  
  /* Language selector */
  .lang-selector{display:flex;gap:8px;margin-left:auto;align-items:center}
  .lang-btn{padding:6px 10px;border-radius:6px;background:var(--panel);border:1px solid rgba(0,0,0,0.05);cursor:pointer;font-size:12px}
  .lang-btn.active{background:var(--accent);color:white}
  
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .tab{padding:8px 10px;border-radius:8px;background:var(--panel);cursor:pointer;color:var(--muted);border:1px solid rgba(0,0,0,0.05)}
  .tab.active{background:linear-gradient(90deg, rgba(11,77,182,0.12), rgba(6,56,110,0.06));color:var(--accent);box-shadow:0 4px 12px rgba(0,0,0,0.08)}
  .layout{display:grid;grid-template-columns:1fr;gap:14px}
  .panel{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.05)}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  input,select,textarea,button{font-size:13px}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);background:white;color:#212529}
  textarea{min-height:80px;resize:vertical}
  .btn{background:var(--accent);color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  
  /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ - –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω, —á—ë—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
  .btn.primary{background:var(--btn-success);color:var(--btn-text);border:1px solid rgba(0,0,0,0.1)}
  .btn.primary:hover{background:#45a049;transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.1)}
  
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,0,0,0.1)}
  .btn.small{padding:6px 8px;font-size:12px}
  .section{margin-bottom:12px}
  .energy-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .energy-item{display:flex;flex-direction:column;gap:4px;padding:10px;border-radius:8px;background:var(--panel);border:1px solid rgba(0,0,0,0.05)}
  .energy-name{font-weight:600;color:var(--accent);font-size:13px}
  .energy-description{font-size:11px;color:var(--muted);line-height:1.3}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{padding:6px 10px;border-radius:999px;background:var(--panel);border:1px solid rgba(0,0,0,0.05);cursor:pointer;color:var(--muted)}
  .chip.sel{background:var(--accent);color:white}
  .flex{display:flex;gap:8px;align-items:center}
  .right{margin-left:auto}
  table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
  th,td{border:1px solid rgba(0,0,0,0.1);padding:8px;text-align:left;vertical-align:top}
  th{background:rgba(0,0,0,0.02);font-weight:600}
  .small{color:var(--muted);font-size:13px}
  .collapsible{background:var(--panel);padding:8px;border-radius:8px;margin-top:8px;border:1px solid rgba(0,0,0,0.05)}
  .hidden{display:none !important}
  .step-card{border-radius:8px;padding:10px;border:1px solid rgba(0,0,0,0.05);margin-bottom:8px;background:white}
  .energy-assessment{display:grid;grid-template-columns:1fr 320px;gap:8px;align-items:start}
  .assess-row{display:flex;gap:6px;align-items:center}
  .barrier-list{max-height:120px;overflow:auto;padding:6px;border-radius:6px;background:rgba(0,0,0,0.03)}
  .notification{position:fixed;top:18px;right:18px;padding:12px 16px;border-radius:8px;background:#f8f9fa;border:1px solid rgba(0,0,0,0.1);z-index:9999}
  .legend{display:flex;gap:8px;align-items:center;margin-top:8px}
  .legend .box{width:14px;height:14px;border-radius:4px}
  .barrier-with-hierarchy { display: grid; grid-template-columns: 1fr 180px auto; gap: 8px; align-items: center; margin-bottom: 8px; padding: 8px; background: white; border-radius: 6px; border: 1px solid rgba(0,0,0,0.1); }
  .hierarchy-select { min-width: 180px; }
  .risk-assessment-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; }
  .residual-risk-section { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); }
  .stat-card { padding: 12px; border-radius: 8px; background: white; border: 1px solid rgba(0,0,0,0.1); text-align: center; }
  .stat-value { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
  .stat-label { font-size: 12px; color: var(--muted); }

  /* Matrix styles */
  .matrix-wrap { overflow:auto; border-radius:8px; padding:8px; background:white; border:1px solid rgba(0,0,0,0.05) }
  .matrix-table { border-collapse:collapse; width:100%; min-width:720px; }
  .matrix-table th, .matrix-table td { border:1px solid rgba(0,0,0,0.08); padding:10px; text-align:center; vertical-align:middle; font-size:13px; position:relative; }
  .matrix-table th.header { background:#f5f7f8; font-weight:700; color:#222; }
  .matrix-code { font-weight:700; margin-bottom:6px; display:block; }
  .matrix-desc { font-size:12px; color:var(--muted); line-height:1.2; }

  /* Updated risk colors with gradients */
  .risk-low { 
    background: linear-gradient(135deg, #e8f5e8, #4caf50); 
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    color: #1b5e20;
    font-weight: 600;
  }

  .risk-medium { 
    background: linear-gradient(135deg, #fff3e0, #ff9800); 
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    color: #e65100;
    font-weight: 600;
  }

  .risk-high { 
    background: linear-gradient(135deg, #ffebee, #f44336); 
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    color: #b71c1c;
    font-weight: 600;
  }

  /* Tooltip (modern, light) */
  .tooltip {
    position:fixed;
    background:#ffffff;
    color:#111;
    border-radius:8px;
    padding:10px 12px;
    box-shadow:0 6px 18px rgba(0,0,0,0.14);
    font-size:13px;
    pointer-events:none;
    opacity:0;
    transform:translateY(-6px) scale(0.98);
    transition:opacity .15s ease, transform .15s ease;
    z-index:3000;
    max-width:280px;
  }
  .tooltip.show { opacity:1; transform:translateY(-10px) scale(1); }

  /* –®–∏—Ä–æ–∫–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ */
  .wide-input { width: 100%; min-width: 400px; }
  .wide-textarea { width: 100%; min-height: 100px; }
  .barrier-input { width: 100%; min-width: 500px; }
  .barrier-textarea { width: 100%; min-height: 60px; resize: vertical; }

  @media (max-width:1024px){
    .energy-grid{grid-template-columns:1fr}
    .wide-input, .barrier-input { min-width: 100%; }
    .lang-selector{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1 id="app-title">QHSE Solutions.kz ‚Äî Risk Assessment Tool</h1>
      <div class="subtitle" id="app-subtitle">Offline ¬∑ –ü–ü–† –ø–æ —à–∞–≥–∞–º ¬∑ 12 —ç–Ω–µ—Ä–≥–∏–π ¬∑ –ü–µ—Ä–≤–∏—á–Ω—ã–π/–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫ ¬∑ –≠–∫—Å–ø–æ—Ä—Ç Excel</div>
      <div class="tabs" style="margin-top:10px">
        <div class="tab active" data-tab="tab-steps" id="tab-steps-btn">–ü–ü–† / –≠—Ç–∞–ø—ã</div>
        <div class="tab" data-tab="tab-info" id="tab-info-btn">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        <div class="tab" data-tab="tab-matrix" id="tab-matrix-btn">–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤</div>
        <div class="tab" data-tab="tab-registry" id="tab-registry-btn">–†–µ–µ—Å—Ç—Ä</div>
        <div class="tab" data-tab="tab-export" id="tab-export-btn">–≠–∫—Å–ø–æ—Ä—Ç</div>
      </div>
    </div>
    <div class="lang-selector">
      <button class="lang-btn active" data-lang="ru">RU</button>
      <button class="lang-btn" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="kz">KZ</button>
    </div>
  </header>

  <div class="layout" style="margin-top:12px">
    <!-- Steps tab -->
    <div id="tab-steps" class="panel tab-pane">
      <h3 id="steps-title">üìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç (–ü–ü–†) ‚Äî —à–∞–≥–∏</h3>
      <div class="section">
        <div style="display:flex;gap:8px">
          <input id="newStepName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞)" class="wide-input"/>
          <button class="btn primary" onclick="addStep()" id="add-step-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="help small" id="steps-help">–î–æ–±–∞–≤–ª—è–π—Ç–µ —à–∞–≥–∏ –≤—Ä—É—á–Ω—É—é, –∑–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–æ–≤</div>
      </div>

      <div id="stepsContainer" class="section"></div>
    </div>

    <!-- Info tab -->
    <div id="tab-info" class="panel tab-pane hidden">
      <h3 id="info-title">üìö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h3>
      
      <div class="section">
        <h4 id="energy-wheel-title">–ö–æ–ª–µ—Å–æ —ç–Ω–µ—Ä–≥–∏–π</h4>
        <div id="energyList" class="energy-grid"></div>
        <div class="help small" id="energy-help">12 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π</div>
      </div>

      <div class="section">
        <h4 id="hierarchy-title">–ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è</h4>
        <div id="hierarchyPanel" class="collapsible"></div>
      </div>
    </div>

    <!-- Matrix tab -->
    <div id="tab-matrix" class="panel tab-pane hidden">
      <h3 id="matrix-title">üìä –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ (A‚ÄìE √ó 1‚Äì5)</h3>
      <div class="section matrix-wrap">
        <table class="matrix-table" id="riskMatrix">
          <thead>
            <tr>
              <th class="header" id="matrix-header-severity">–¢—è–∂–µ—Å—Ç—å \ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</th>
              <th class="header" id="matrix-header-a">A<br><small id="matrix-desc-a">–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ</small></th>
              <th class="header" id="matrix-header-b">B<br><small id="matrix-desc-b">–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ</small></th>
              <th class="header" id="matrix-header-c">C<br><small id="matrix-desc-c">–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</small></th>
              <th class="header" id="matrix-header-d">D<br><small id="matrix-desc-d">–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</small></th>
              <th class="header" id="matrix-header-e">E<br><small id="matrix-desc-e">–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</small></th>
            </tr>
          </thead>
          <tbody id="matrixBody">
            <!-- rendered by JS -->
          </tbody>
        </table>
        <div class="legend" style="margin-top:12px">
          <div class="box" style="background:linear-gradient(135deg, #e8f5e8, #4caf50)"></div><span id="legend-low">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</span>
          <div class="box" style="background:linear-gradient(135deg, #fff3e0, #ff9800)"></div><span id="legend-medium">–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫</span>
          <div class="box" style="background:linear-gradient(135deg, #ffebee, #f44336)"></div><span id="legend-high">–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</span>
        </div>
      </div>
    </div>

    <!-- Registry -->
    <div id="tab-registry" class="panel tab-pane hidden">
      <h3 id="registry-title">üìã –†–µ–µ—Å—Ç—Ä —Ä–∏—Å–∫–æ–≤</h3>
      <div class="section">
        <table id="registryTable">
          <thead>
            <tr>
              <th id="registry-col1">#</th>
              <th id="registry-col2">–≠—Ç–∞–ø</th>
              <th id="registry-col3">–≠–Ω–µ—Ä–≥–∏—è</th>
              <th id="registry-col4">–û–ø–∞—Å–Ω–æ—Å—Ç—å</th>
              <th id="registry-col5">–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ</th>
              <th id="registry-col6">–ü–µ—Ä–≤–∏—á–Ω—ã–π</th>
              <th id="registry-col7">–£—Ä–æ–≤–µ–Ω—å</th>
              <th id="registry-col8">–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ</th>
              <th id="registry-col9">–ò–µ—Ä–∞—Ä—Ö–∏—è (–ü—Ä–æ–∞–∫—Ç)</th>
              <th id="registry-col10">–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</th>
              <th id="registry-col11">–ò–µ—Ä–∞—Ä—Ö–∏—è (–†–µ–∞–∫—Ç)</th>
              <th id="registry-col12">–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π</th>
              <th id="registry-col13">–£—Ä–æ–≤–µ–Ω—å –æ—Å—Ç.</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="small" style="margin-top:8px" id="registry-help">–ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏.</div>
      </div>
    </div>

    <!-- Export -->
    <div id="tab-export" class="panel tab-pane hidden">
      <h3 id="export-title">üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ / –≠–∫—Å–ø–æ—Ä—Ç</h3>
      <div class="section">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn primary" onclick="exportExcel()" id="export-excel-btn">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
          <button class="btn ghost" onclick="clearAll()" id="clear-all-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        </div>
        <div class="small" style="margin-top:8px" id="export-help">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Excel –∏–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</div>
      </div>
      <div class="section">
        <h4 id="analytics-title">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤</h4>
        <div class="stats-grid" id="analyticsStats"></div>
      </div>
    </div>
  </div>

  <div class="copyright" style="text-align:center;margin-top:18px;color:var(--muted);font-size:12px" id="copyright">
    ¬© 2025 QHSE Solutions. All rights reserved.
  </div>
</div>

<!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é -->
<div id="home-button" style="position:fixed;bottom:20px;right:20px;z-index:100;transition:all 0.3s ease">
  <a href="index.html" style="display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:var(--accent);color:white;border-radius:10px;text-decoration:none;font-size:12px;font-weight:600;box-shadow:0 4px 12px rgba(11,77,182,0.2);border:1px solid rgba(255,255,255,0.1);transition:all 0.2s ease">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 12l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l-7-7m7 7v13"/>
    </svg>
    <span id="home-button-text">–ì–ª–∞–≤–Ω–∞—è</span>
  </a>
</div>

<!-- notification and tooltip -->
<div id="notif" class="notification hidden"></div>
<div id="matrixTooltip" class="tooltip" aria-hidden="true"></div>

<!-- datalist for consequences -->
<datalist id="consequenceSuggestions"></datalist>

<script>
/* ===========================
   –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å
   =========================== */
const TRANSLATIONS = {
  ru: {
    // –û–±—â–∏–µ
    appTitle: "QHSE Solutions.kz ‚Äî –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤",
    appSubtitle: "Offline ¬∑ –ü–ü–† –ø–æ —à–∞–≥–∞–º ¬∑ 12 —ç–Ω–µ—Ä–≥–∏–π ¬∑ –ü–µ—Ä–≤–∏—á–Ω—ã–π/–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫ ¬∑ –≠–∫—Å–ø–æ—Ä—Ç Excel",
    copyright: "¬© 2025 QHSE Solutions. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.",
    homeButtonText: "–ì–ª–∞–≤–Ω–∞—è",
    
    // –í–∫–ª–∞–¥–∫–∏
    tabSteps: "–ü–ü–† / –≠—Ç–∞–ø—ã",
    tabInfo: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
    tabMatrix: "–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤",
    tabRegistry: "–†–µ–µ—Å—Ç—Ä",
    tabExport: "–≠–∫—Å–ø–æ—Ä—Ç",
    
    // –®–∞–≥–∏
    stepsTitle: "üìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç (–ü–ü–†) ‚Äî —à–∞–≥–∏",
    addStepBtn: "‚ûï –î–æ–±–∞–≤–∏—Ç—å",
    stepsHelp: "–î–æ–±–∞–≤–ª—è–π—Ç–µ —à–∞–≥–∏ –≤—Ä—É—á–Ω—É—é, –∑–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–æ–≤",
    stepNamePlaceholder: "–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞)",
    
    // –ö–Ω–æ–ø–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —à–∞–≥–∞
    analyzeBtn: "–ê–Ω–∞–ª–∏–∑",
    editBtn: "‚úé",
    deleteBtn: "üóë",
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    infoTitle: "üìö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫",
    energyWheelTitle: "–ö–æ–ª–µ—Å–æ —ç–Ω–µ—Ä–≥–∏–π",
    energyHelp: "12 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π",
    hierarchyTitle: "–ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è",
    
    // –ú–∞—Ç—Ä–∏—Ü–∞
    matrixTitle: "üìä –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ (A‚ÄìE √ó 1‚Äì5)",
    matrixSeverity: "–¢—è–∂–µ—Å—Ç—å \\ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å",
    matrixA: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ",
    matrixB: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ",
    matrixC: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
    matrixD: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
    matrixE: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
    legendLow: "–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫",
    legendMedium: "–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫",
    legendHigh: "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫",
    
    // –†–µ–µ—Å—Ç—Ä
    registryTitle: "üìã –†–µ–µ—Å—Ç—Ä —Ä–∏—Å–∫–æ–≤",
    registryHelp: "–ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏.",
    registryCols: ["#", "–≠—Ç–∞–ø", "–≠–Ω–µ—Ä–≥–∏—è", "–û–ø–∞—Å–Ω–æ—Å—Ç—å", "–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ", "–ü–µ—Ä–≤–∏—á–Ω—ã–π", "–£—Ä–æ–≤–µ–Ω—å", 
                   "–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ", "–ò–µ—Ä–∞—Ä—Ö–∏—è (–ü—Ä–æ–∞–∫—Ç)", "–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ", "–ò–µ—Ä–∞—Ä—Ö–∏—è (–†–µ–∞–∫—Ç)", 
                   "–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π", "–£—Ä–æ–≤–µ–Ω—å –æ—Å—Ç."],
    
    // –≠–∫—Å–ø–æ—Ä—Ç
    exportTitle: "üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ / –≠–∫—Å–ø–æ—Ä—Ç",
    analyticsTitle: "üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤",
    exportExcelBtn: "üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel",
    clearAllBtn: "üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë",
    exportHelp: "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Excel –∏–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ",
    
    // –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤
    addAssessmentBtn: "–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É",
    editAssessmentBtn: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
    removeAssessmentBtn: "–£–¥–∞–ª–∏—Ç—å",
    hazardLabel: "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
    hazardPlaceholder: "–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞–¥–µ–Ω–∏–µ —Å –≤—ã—Å–æ—Ç—ã",
    consequenceLabel: "–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
    proactiveLabel: "–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ä—å–µ—Ä—ã (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ)",
    reactiveLabel: "–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ä—å–µ—Ä—ã (—Å–º—è–≥—á–µ–Ω–∏–µ)",
    addBarrierBtn: "–î–æ–±–∞–≤–∏—Ç—å",
    preBarrierPlaceholder: "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä",
    postBarrierPlaceholder: "–î–æ–±–∞–≤–∏—Ç—å —Å–º—è–≥—á–∞—é—â–∏–π –±–∞—Ä—å–µ—Ä",
    severityLabel: "–û—Ü–µ–Ω–∫–∞ —Ç—è–∂–µ—Å—Ç–∏",
    probabilityLabel: "–û—Ü–µ–Ω–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏",
    calculatedRisk: "–†–∞—Å—á–µ—Ç–Ω—ã–π —Ä–∏—Å–∫ (–ø–µ—Ä–≤–∏—á–Ω—ã–π):",
    saveRiskBtn: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞",
    autoBarriersBtn: "–ê–≤—Ç–æ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±–∞—Ä—å–µ—Ä–æ–≤",
    residualTitle: "–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫",
    residualSeverity: "–û—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç—è–∂–µ—Å—Ç—å",
    residualProbability: "–û—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å",
    residualRisk: "–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫:",
    saveResidualBtn: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫",
    closeBtn: "–ó–∞–∫—Ä—ã—Ç—å",
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    enterStepName: "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞",
    removeStepConfirm: "–£–¥–∞–ª–∏—Ç—å —à–∞–≥ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏?",
    stepAdded: "–®–∞–≥ –¥–æ–±–∞–≤–ª–µ–Ω",
    stepRemoved: "–®–∞–≥ —É–¥–∞–ª—ë–Ω",
    stepNamePrompt: "–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞",
    stepDescPrompt: "–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞",
    noSteps: "–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤. –î–æ–±–∞–≤—å—Ç–µ —à–∞–≥–∏ –≤—Ä—É—á–Ω—É—é.",
    noAssessments: "–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫ —Ä–∏—Å–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ '–ü–ü–† / –≠—Ç–∞–ø—ã'.",
    noDataExport: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞",
    
    // –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ - –æ–ø–∏—Å–∞–Ω–∏—è —Ç—è–∂–µ—Å—Ç–∏
    severity5: "–ì—Ä—É–ø–ø–æ–≤–∞—è –≥–∏–±–µ–ª—å",
    severity4: "–û–¥–∏–Ω —Å–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π —Å–ª—É—á–∞–π",
    severity3: "–¢—è–∂—ë–ª–∞—è —Ç—Ä–∞–≤–º–∞ –∏–ª–∏ –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—é",
    severity2: "–¢—Ä–∞–≤–º–∞ –∏–ª–∏ –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—è —Å—Ä–µ–¥–Ω–µ–π —Ç—è–∂–µ—Å—Ç–∏",
    severity1: "–õ—ë–≥–∫–∞—è —Ç—Ä–∞–≤–º–∞ –∏–ª–∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—é",
    
    // –ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è
    hierarchy: [
      {
        level: "1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ",
        description: "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞, –∑–∞–º–µ–Ω–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π"
      },
      {
        level: "2. –ó–∞–º–µ–Ω–∞",
        description: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω–µ–µ –æ–ø–∞—Å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤ –∏–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤"
      },
      {
        level: "3. –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –º–µ—Ä—ã",
        description: "–û–≥—Ä–∞–∂–¥–µ–Ω–∏—è, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –∑–∞—â–∏—Ç–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∞–≤–∞—Ä–∏–π–Ω—ã–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
      },
      {
        level: "4. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ä—ã",
        description: "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –æ–±—É—á–µ–Ω–∏–µ, –Ω–∞–¥–∑–æ—Ä, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ä–∏—Å–∫–∞"
      },
      {
        level: "5. –°–ò–ó",
        description: "–ö–∞—Å–∫–∏, –ø–µ—Ä—á–∞—Ç–∫–∏, —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä—ã, –∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏ –∏ –¥—Ä—É–≥–∏–µ –°–ò–ó"
      }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
    consequenceLevels: [
      { level: 1, description: "–õ—ë–≥–∫–∞—è —Ç—Ä–∞–≤–º–∞ –∏–ª–∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—é" },
      { level: 2, description: "–¢—Ä–∞–≤–º–∞ –∏–ª–∏ –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—è —Å—Ä–µ–¥–Ω–µ–π —Ç—è–∂–µ—Å—Ç–∏" },
      { level: 3, description: "–¢—è–∂—ë–ª–∞—è —Ç—Ä–∞–≤–º–∞ –∏–ª–∏ –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—é" },
      { level: 4, description: "–û–¥–∏–Ω —Å–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π —Å–ª—É—á–∞–π" },
      { level: 5, description: "–ì—Ä—É–ø–ø–æ–≤–∞—è –≥–∏–±–µ–ª—å" }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    probabilityLevels: [
      { level: "A", label: "1. –ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ", description: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
      { level: "B", label: "2. –†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ", description: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
      { level: "C", label: "3. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ", description: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
      { level: "D", label: "4. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ", description: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
      { level: "E", label: "5. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ", description: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" }
    ]
  },
  
  en: {
    // General
    appTitle: "QHSE Solutions.kz ‚Äî Risk Assessment Tool",
    appSubtitle: "Offline ¬∑ Step-by-step work plan ¬∑ 12 energies ¬∑ Primary/residual risk ¬∑ Excel export",
    copyright: "¬© 2025 QHSE Solutions. All rights reserved.",
    homeButtonText: "Home",
    
    // Tabs
    tabSteps: "Work Plan / Steps",
    tabInfo: "Information",
    tabMatrix: "Risk Matrix",
    tabRegistry: "Registry",
    tabExport: "Export",
    
    // Steps
    stepsTitle: "üìã Work Execution Plan ‚Äî Steps",
    addStepBtn: "‚ûï Add",
    stepsHelp: "Add steps manually, then add risk assessments for each step",
    stepNamePlaceholder: "Step name (e.g.: Workplace preparation)",
    
    // Step card buttons
    analyzeBtn: "Analysis",
    editBtn: "‚úé",
    deleteBtn: "üóë",
    
    // Information
    infoTitle: "üìö Information Reference",
    energyWheelTitle: "Energy Wheel",
    energyHelp: "12 energy sources for hazard identification",
    hierarchyTitle: "Hierarchy of Controls",
    
    // Matrix
    matrixTitle: "üìä Risk Matrix (A‚ÄìE √ó 1‚Äì5)",
    matrixSeverity: "Severity \\ Probability",
    matrixA: "Never occurred worldwide",
    matrixB: "Rarely occurred worldwide",
    matrixC: "Occurred sometimes worldwide, but not in Kazakhstan",
    matrixD: "Rarely occurred worldwide, but regularly in Kazakhstan",
    matrixE: "Occurs regularly in Kazakhstan",
    legendLow: "Low risk",
    legendMedium: "Medium risk",
    legendHigh: "High risk",
    
    // Registry
    registryTitle: "üìã Risk Registry",
    registryHelp: "Click on a row to open assessment editor.",
    registryCols: ["#", "Step", "Energy", "Hazard", "Consequence", "Primary", "Level", 
                   "Proactive", "Hierarchy (Proactive)", "Reactive", "Hierarchy (Reactive)", 
                   "Residual", "Residual Level"],
    
    // Export
    exportTitle: "üì§ Save / Export",
    analyticsTitle: "üìà Risk Analytics",
    exportExcelBtn: "üìä Export to Excel",
    clearAllBtn: "üîÑ Reset all",
    exportHelp: "Export data to Excel or reset all data",
    
    // Risk assessment
    addAssessmentBtn: "Add assessment",
    editAssessmentBtn: "Edit",
    removeAssessmentBtn: "Remove",
    hazardLabel: "Hazard name",
    hazardPlaceholder: "e.g.: Fall from height",
    consequenceLabel: "Consequence (required)",
    proactiveLabel: "Proactive barriers (prevention)",
    reactiveLabel: "Reactive barriers (mitigation)",
    addBarrierBtn: "Add",
    preBarrierPlaceholder: "Add preventive barrier",
    postBarrierPlaceholder: "Add mitigation barrier",
    severityLabel: "Severity assessment",
    probabilityLabel: "Probability assessment",
    calculatedRisk: "Calculated risk (primary):",
    saveRiskBtn: "Save risk assessment",
    autoBarriersBtn: "Auto-suggest barriers",
    residualTitle: "Residual risk",
    residualSeverity: "Residual severity",
    residualProbability: "Residual probability",
    residualRisk: "Residual risk:",
    saveResidualBtn: "Save residual risk",
    closeBtn: "Close",
    
    // Notifications
    enterStepName: "Enter step name",
    removeStepConfirm: "Delete step and all related assessments?",
    stepAdded: "Step added",
    stepRemoved: "Step removed",
    stepNamePrompt: "Step name",
    stepDescPrompt: "Step description",
    noSteps: "No steps added. Add steps manually.",
    noAssessments: "No risk assessments. Add assessments in 'Work Plan / Steps' tab.",
    noDataExport: "No data to export",
    
    // –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ - –æ–ø–∏—Å–∞–Ω–∏—è —Ç—è–∂–µ—Å—Ç–∏
    severity5: "Group fatality",
    severity4: "One fatal case",
    severity3: "Severe injury or health damage",
    severity2: "Moderate injury or health damage",
    severity1: "Minor injury or insignificant health damage",
    
    // –ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è
    hierarchy: [
      {
        level: "1. Elimination",
        description: "Process automation, replacement of hazardous material with safe material"
      },
      {
        level: "2. Substitution",
        description: "Use of less hazardous substances or technologies, use of safe alternatives"
      },
      {
        level: "3. Engineering controls",
        description: "Guarding, ventilation, lockout/tagout, alarms, protective devices, emergency stop buttons, technical safety devices"
      },
      {
        level: "4. Administrative controls",
        description: "Briefings, procedures, training, supervision, organizational measures to reduce risk"
      },
      {
        level: "5. PPE",
        description: "Helmets, gloves, respirators, safety glasses and other personal protective equipment"
      }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
    consequenceLevels: [
      { level: 1, description: "Minor injury or insignificant health damage" },
      { level: 2, description: "Moderate injury or health damage" },
      { level: 3, description: "Severe injury or health damage" },
      { level: 4, description: "One fatal case" },
      { level: 5, description: "Group fatality" }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    probabilityLevels: [
      { level: "A", label: "1. Never occurred worldwide", description: "Never occurred worldwide" },
      { level: "B", label: "2. Rarely occurred worldwide", description: "Rarely occurred worldwide" },
      { level: "C", label: "3. Occurred sometimes worldwide, but not in Kazakhstan", description: "Occurred sometimes worldwide, but not in Kazakhstan" },
      { level: "D", label: "4. Rarely occurred worldwide, but regularly in Kazakhstan", description: "Rarely occurred worldwide, but regularly in Kazakhstan" },
      { level: "E", label: "5. Occurs regularly in Kazakhstan", description: "Occurs regularly in Kazakhstan" }
    ]
  },
  
  kz: {
    // –ñ–∞–ª–ø—ã
    appTitle: "QHSE Solutions.kz ‚Äî –¢”ô—É–µ–∫–µ–ª–¥—ñ –±–∞“ì–∞–ª–∞—É “õ“±—Ä–∞–ª—ã",
    appSubtitle: "–û—Ñ–ª–∞–π–Ω ¬∑ –°–∞—Ç—ã–ª–∞—Ä –±–æ–π—ã–Ω—à–∞ –∂“±–º—ã—Å –∂–æ—Å–ø–∞—Ä—ã ¬∑ 12 —ç–Ω–µ—Ä–≥–∏—è ¬∑ –ë–∞—Å—Ç–∞–ø“õ—ã/“õ–∞–ª–¥—ã“õ —Ç”ô—É–µ–∫–µ–ª ¬∑ Excel —ç–∫—Å–ø–æ—Ä—Ç—ã",
    copyright: "¬© 2025 QHSE Solutions. –ë–∞—Ä–ª—ã“õ “õ“±“õ—ã“õ—Ç–∞—Ä “õ–æ—Ä“ì–∞–ª“ì–∞–Ω.",
    homeButtonText: "–ë–∞—Å—Ç—ã –±–µ—Ç",
    
    // “ö–æ–π—ã–Ω–¥—ã–ª–∞—Ä
    tabSteps: "–ñ–ñ–ñ / –°–∞—Ç—ã–ª–∞—Ä",
    tabInfo: "–ê“õ–ø–∞—Ä–∞—Ç",
    tabMatrix: "–¢”ô—É–µ–∫–µ–ª –º–∞—Ç—Ä–∏—Ü–∞—Å—ã",
    tabRegistry: "–¢—ñ—Ä–∫–µ—É",
    tabExport: "–≠–∫—Å–ø–æ—Ä—Ç",
    
    // –°–∞—Ç—ã–ª–∞—Ä
    stepsTitle: "üìã –ñ“±–º—ã—Å—Ç—ã –æ—Ä—ã–Ω–¥–∞—É —Ç”ô—Ä—Ç—ñ–±—ñ (–ñ–ñ–ñ) ‚Äî —Å–∞—Ç—ã–ª–∞—Ä",
    addStepBtn: "‚ûï “ö–æ—Å—É",
    stepsHelp: "–°–∞—Ç—ã–ª–∞—Ä–¥—ã “õ–æ–ª–º–µ–Ω “õ–æ—Å—ã“£—ã–∑, —Å–æ–¥–∞–Ω –∫–µ–π—ñ–Ω ”ô—Ä —Å–∞—Ç“õ–∞ —Ç”ô—É–µ–∫–µ–ª –±–∞“ì–∞–ª–∞—É—ã–Ω “õ–æ—Å—ã“£—ã–∑",
    stepNamePlaceholder: "–°–∞—Ç—ã –∞—Ç–∞—É—ã (–º—ã—Å–∞–ª—ã: –ñ“±–º—ã—Å –æ—Ä–Ω—ã–Ω –¥–∞–π—ã–Ω–¥–∞—É)",
    
    // –°–∞—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∞—Å—ã —Ç“Ø–π–º–µ–ª–µ—Ä—ñ
    analyzeBtn: "–¢–∞–ª–¥–∞—É",
    editBtn: "‚úé",
    deleteBtn: "üóë",
    
    // –ê“õ–ø–∞—Ä–∞—Ç
    infoTitle: "üìö –ê“õ–ø–∞—Ä–∞—Ç—Ç—ã“õ –∞–Ω—ã“õ—Ç–∞–º–∞",
    energyWheelTitle: "–≠–Ω–µ—Ä–≥–∏—è –¥–æ“£“ì–∞–ª–∞“ì—ã",
    energyHelp: "“ö–∞—É—ñ–ø—Ç—ñ –∞–Ω—ã“õ—Ç–∞—É “Ø—à—ñ–Ω 12 —ç–Ω–µ—Ä–≥–∏—è –∫”©–∑—ñ",
    hierarchyTitle: "–ë–∞—Å“õ–∞—Ä—É —à–∞—Ä–∞–ª–∞—Ä—ã–Ω—ã“£ –∏–µ—Ä–∞—Ä—Ö–∏—è—Å—ã",
    
    // –ú–∞—Ç—Ä–∏—Ü–∞
    matrixTitle: "üìä –¢”ô—É–µ–∫–µ–ª –º–∞—Ç—Ä–∏—Ü–∞—Å—ã (A‚ÄìE √ó 1‚Äì5)",
    matrixSeverity: "–ê—É—ã—Ä–ª—ã“õ \\ –´“õ—Ç–∏–º–∞–ª–¥—ã“õ",
    matrixA: "”ò–ª–µ–º–¥–µ –µ—à“õ–∞—à–∞–Ω –±–æ–ª“ì–∞–Ω –∂–æ“õ",
    matrixB: "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã",
    matrixC: "”ò–ª–µ–º–¥–µ –∫–µ–π–¥–µ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ –µ–º–µ—Å",
    matrixD: "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ",
    matrixE: "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ –±–æ–ª–∞–¥—ã",
    legendLow: "–¢”©–º–µ–Ω —Ç”ô—É–µ–∫–µ–ª",
    legendMedium: "–û—Ä—Ç–∞—à–∞ —Ç”ô—É–µ–∫–µ–ª",
    legendHigh: "–ñ–æ“ì–∞—Ä—ã —Ç”ô—É–µ–∫–µ–ª",
    
    // –¢—ñ—Ä–∫–µ—É
    registryTitle: "üìã –¢”ô—É–µ–∫–µ–ª —Ç—ñ—Ä–∫–µ—É—ñ",
    registryHelp: "–ñ–æ–ª–¥—ã –±–∞—Å—É - –±–∞“ì–∞–ª–∞—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã–Ω –∞—à—É.",
    registryCols: ["‚Ññ", "–°–∞—Ç—ã", "–≠–Ω–µ—Ä–≥–∏—è", "“ö–∞—É—ñ–ø", "–°–∞–ª–¥–∞—Ä", "–ë–∞—Å—Ç–∞–ø“õ—ã", "–î–µ“£–≥–µ–π", 
                   "–ü—Ä–æ–∞–∫—Ç–∏–≤—Ç—ñ", "–ò–µ—Ä–∞—Ä—Ö–∏—è (–ü—Ä–æ–∞–∫—Ç–∏–≤—Ç—ñ)", "–†–µ–∞–∫—Ç–∏–≤—Ç—ñ", "–ò–µ—Ä–∞—Ä—Ö–∏—è (–†–µ–∞–∫—Ç–∏–≤—Ç—ñ)", 
                   "“ö–∞–ª–¥—ã“õ", "“ö–∞–ª–¥—ã“õ –¥–µ“£–≥–µ–π—ñ"],
    
    // –≠–∫—Å–ø–æ—Ä—Ç
    exportTitle: "üì§ –°–∞“õ—Ç–∞—É / –≠–∫—Å–ø–æ—Ä—Ç",
    analyticsTitle: "üìà –¢”ô—É–µ–∫–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∞—Å—ã",
    exportExcelBtn: "üìä Excel-–≥–µ —ç–∫—Å–ø–æ—Ä—Ç",
    clearAllBtn: "üîÑ –ë–∞—Ä–ª—ã“ì—ã–Ω “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É",
    exportHelp: "–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ Excel-–≥–µ —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞“£—ã–∑ –Ω–µ–º–µ—Å–µ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ“£—ñ–∑",
    
    // –¢”ô—É–µ–∫–µ–ª–¥—ñ –±–∞“ì–∞–ª–∞—É
    addAssessmentBtn: "–ë–∞“ì–∞–ª–∞—É “õ–æ—Å—É",
    editAssessmentBtn: "”®“£–¥–µ—É",
    removeAssessmentBtn: "–ñ–æ—é",
    hazardLabel: "“ö–∞—É—ñ–ø –∞—Ç–∞—É—ã",
    hazardPlaceholder: "–ú—ã—Å–∞–ª—ã: –ë–∏—ñ–∫—Ç—ñ–∫—Ç–µ–Ω “õ“±–ª–∞—É",
    consequenceLabel: "–°–∞–ª–¥–∞—Ä (–º—ñ–Ω–¥–µ—Ç—Ç—ñ)",
    proactiveLabel: "–ü—Ä–æ–∞–∫—Ç–∏–≤—Ç—ñ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä (–∞–ª–¥—ã–Ω –∞–ª—É)",
    reactiveLabel: "–†–µ–∞–∫—Ç–∏–≤—Ç—ñ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä (–∂–µ“£—ñ–ª–¥–µ—Ç—É)",
    addBarrierBtn: "“ö–æ—Å—É",
    preBarrierPlaceholder: "–ê–ª–¥—ã–Ω –∞–ª—É –∫–µ–¥–µ—Ä–≥—ñ—Å—ñ–Ω “õ–æ—Å—É",
    postBarrierPlaceholder: "–ñ–µ“£—ñ–ª–¥–µ—Ç—É –∫–µ–¥–µ—Ä–≥—ñ—Å—ñ–Ω “õ–æ—Å—É",
    severityLabel: "–ê—É—ã—Ä–ª—ã“õ –±–∞“ì–∞—Å—ã",
    probabilityLabel: "–´“õ—Ç–∏–º–∞–ª–¥—ã“õ –±–∞“ì–∞—Å—ã",
    calculatedRisk: "–ï—Å–µ–ø—Ç–µ–ª–≥–µ–Ω —Ç”ô—É–µ–∫–µ–ª (–±–∞—Å—Ç–∞–ø“õ—ã):",
    saveRiskBtn: "–¢”ô—É–µ–∫–µ–ª –±–∞“ì–∞–ª–∞—É—ã–Ω —Å–∞“õ—Ç–∞—É",
    autoBarriersBtn: "–ö–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä–¥—ñ –∞–≤—Ç–æ-“±—Å—ã–Ω—É",
    residualTitle: "“ö–∞–ª–¥—ã“õ —Ç”ô—É–µ–∫–µ–ª",
    residualSeverity: "“ö–∞–ª–¥—ã“õ –∞—É—ã—Ä–ª—ã“õ",
    residualProbability: "“ö–∞–ª–¥—ã“õ —ã“õ—Ç–∏–º–∞–ª–¥—ã“õ",
    residualRisk: "“ö–∞–ª–¥—ã“õ —Ç”ô—É–µ–∫–µ–ª:",
    saveResidualBtn: "“ö–∞–ª–¥—ã“õ —Ç”ô—É–µ–∫–µ–ª–¥—ñ —Å–∞“õ—Ç–∞—É",
    closeBtn: "–ñ–∞–±—É",
    
    // –•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä
    enterStepName: "–°–∞—Ç—ã –∞—Ç–∞—É—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑",
    removeStepConfirm: "–°–∞—Ç—ã–Ω—ã –∂”ô–Ω–µ –±–∞—Ä–ª—ã“õ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã –±–∞“ì–∞–ª–∞—É–ª–∞—Ä–¥—ã –∂–æ–π—ã“£—ã–∑?",
    stepAdded: "–°–∞—Ç—ã “õ–æ—Å—ã–ª–¥—ã",
    stepRemoved: "–°–∞—Ç—ã –∂–æ–π—ã–ª–¥—ã",
    stepNamePrompt: "–°–∞—Ç—ã –∞—Ç–∞—É—ã",
    stepDescPrompt: "–°–∞—Ç—ã —Å–∏–ø–∞—Ç—Ç–∞–º–∞—Å—ã",
    noSteps: "“ö–æ—Å—ã–ª“ì–∞–Ω —Å–∞—Ç—ã–ª–∞—Ä –∂–æ“õ. –°–∞—Ç—ã–ª–∞—Ä–¥—ã “õ–æ–ª–º–µ–Ω “õ–æ—Å—ã“£—ã–∑.",
    noAssessments: "–¢”ô—É–µ–∫–µ–ª –±–∞“ì–∞–ª–∞—É–ª–∞—Ä—ã –∂–æ“õ. '–ñ–ñ–ñ / –°–∞—Ç—ã–ª–∞—Ä' “õ–æ–π—ã–Ω–¥—ã—Å—ã–Ω–¥–∞ –±–∞“ì–∞–ª–∞—É–ª–∞—Ä–¥—ã “õ–æ—Å—ã“£—ã–∑.",
    noDataExport: "–≠–∫—Å–ø–æ—Ä—Ç—Ç–∞—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–æ“õ",
    
    // –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ - –æ–ø–∏—Å–∞–Ω–∏—è —Ç—è–∂–µ—Å—Ç–∏
    severity5: "–¢–æ–ø—Ç—ã“õ ”©–ª—ñ–º",
    severity4: "–ë—ñ—Ä ”©–ª—ñ–º –∂–∞“ì–¥–∞–π—ã",
    severity3: "–ê—É—ã—Ä –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω",
    severity2: "–û—Ä—Ç–∞—à–∞ –¥”ô—Ä–µ–∂–µ–¥–µ–≥—ñ –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω",
    severity1: "–ñ–µ“£—ñ–ª –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –µ–ª–µ—É—Å—ñ–∑ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω",
    
    // –ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è
    hierarchy: [
      {
        level: "1. –ñ–æ—é",
        description: "–ü—Ä–æ—Ü–µ—Å—Ç—ñ –∞–≤—Ç–æ–º–∞—Ç—Ç–∞–Ω–¥—ã—Ä—É, “õ–∞—É—ñ–ø—Ç—ñ –º–∞—Ç–µ—Ä–∏–∞–ª–¥—ã “õ–∞—É—ñ–ø—Å—ñ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª“ì–∞ –∞—É—ã—Å—Ç—ã—Ä—É"
      },
      {
        level: "2. –ê—É—ã—Å—Ç—ã—Ä—É",
        description: "–ê–∑ “õ–∞—É—ñ–ø—Ç—ñ –∑–∞—Ç—Ç–∞—Ä–¥—ã –Ω–µ–º–µ—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª–∞—Ä–¥—ã “õ–æ–ª–¥–∞–Ω—É, “õ–∞—É—ñ–ø—Å—ñ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–ª–∞—Ä–¥—ã –ø–∞–π–¥–∞–ª–∞–Ω—É"
      },
      {
        level: "3. –ò–Ω–∂–µ–Ω–µ—Ä–ª—ñ–∫ —à–∞—Ä–∞–ª–∞—Ä",
        description: "“ö–æ—Ä“ì–∞—É, –∂–µ–ª–¥–µ—Ç—É, –±“±“ì–∞—Ç—Ç–∞—É/–±–µ–ª–≥—ñ–ª–µ—É, –¥–∞–±—ã–ª–¥–∞—Ä, “õ–æ—Ä“ì–∞–Ω—ã—Å “õ“±—Ä—ã–ª“ì—ã–ª–∞—Ä—ã, –∞–≤–∞—Ä–∏—è–ª—ã“õ —Ç–æ“õ—Ç–∞—Ç—É —Ç“Ø–π–º–µ–ª–µ—Ä—ñ, —Ç–µ—Ö–Ω–∏–∫–∞–ª—ã“õ “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ “õ“±—Ä—ã–ª“ì—ã–ª–∞—Ä—ã"
      },
      {
        level: "4. ”ò–∫—ñ–º—à—ñ–ª—ñ–∫ —à–∞—Ä–∞–ª–∞—Ä",
        description: "–ù“±—Å“õ–∞—É–ª–∞—Ä, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–ª–∞—Ä, –æ“õ—ã—Ç—É, “õ–∞–¥–∞“ì–∞–ª–∞—É, —Ç”ô—É–µ–∫–µ–ª–¥—ñ –∞–∑–∞–π—Ç—É“ì–∞ –±–∞“ì—ã—Ç—Ç–∞–ª“ì–∞–Ω “±–π—ã–º–¥–∞—Å—Ç—ã—Ä—É —à–∞—Ä–∞–ª–∞—Ä—ã"
      },
      {
        level: "5. –ñ–ñ“ö",
        description: "–î”©“£–≥–µ–ª–µ–∫, “õ–æ–ª“ì–∞–ø, —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä–ª–∞—Ä, –∫”©–∑—ñ–ª–¥—ñ—Ä—ñ–∫—Ç–µ—Ä –∂”ô–Ω–µ –±–∞—Å“õ–∞ –¥–∞ –∂–µ–∫–µ “õ–æ—Ä“ì–∞–Ω—ã—Å “õ“±—Ä–∞–ª–¥–∞—Ä—ã"
      }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
    consequenceLevels: [
      { level: 1, description: "–ñ–µ“£—ñ–ª –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –µ–ª–µ—É—Å—ñ–∑ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω" },
      { level: 2, description: "–û—Ä—Ç–∞—à–∞ –¥”ô—Ä–µ–∂–µ–¥–µ–≥—ñ –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω" },
      { level: 3, description: "–ê—É—ã—Ä –∂–∞—Ä–∞“õ–∞—Ç –Ω–µ–º–µ—Å–µ –¥–µ–Ω—Å–∞—É–ª—ã“õ“õ–∞ –∑–∏—è–Ω" },
      { level: 4, description: "–ë—ñ—Ä ”©–ª—ñ–º –∂–∞“ì–¥–∞–π—ã" },
      { level: 5, description: "–¢–æ–ø—Ç—ã“õ ”©–ª—ñ–º" }
    ],
    
    // –£—Ä–æ–≤–Ω–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    probabilityLevels: [
      { level: "A", label: "1. ”ò–ª–µ–º–¥–µ –µ—à“õ–∞—à–∞–Ω –±–æ–ª“ì–∞–Ω –∂–æ“õ", description: "”ò–ª–µ–º–¥–µ –µ—à“õ–∞—à–∞–Ω –±–æ–ª“ì–∞–Ω –∂–æ“õ" },
      { level: "B", label: "2. ”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã", description: "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã" },
      { level: "C", label: "3. ”ò–ª–µ–º–¥–µ –∫–µ–π–¥–µ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ –µ–º–µ—Å", description: "”ò–ª–µ–º–¥–µ –∫–µ–π–¥–µ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ –µ–º–µ—Å" },
      { level: "D", label: "4. ”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ", description: "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ" },
      { level: "E", label: "5. “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ –±–æ–ª–∞–¥—ã", description: "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ –±–æ–ª–∞–¥—ã" }
    ]
  }
};

let currentLang = 'ru';

function changeLanguage(lang) {
  currentLang = lang;
  const t = TRANSLATIONS[lang];
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  document.getElementById('app-title').textContent = t.appTitle;
  document.getElementById('app-subtitle').textContent = t.appSubtitle;
  document.getElementById('copyright').textContent = t.copyright;
  
  // –í–∫–ª–∞–¥–∫–∏
  document.getElementById('tab-steps-btn').textContent = t.tabSteps;
  document.getElementById('tab-info-btn').textContent = t.tabInfo;
  document.getElementById('tab-matrix-btn').textContent = t.tabMatrix;
  document.getElementById('tab-registry-btn').textContent = t.tabRegistry;
  document.getElementById('tab-export-btn').textContent = t.tabExport;
  
  // –®–∞–≥–∏
  document.getElementById('steps-title').textContent = t.stepsTitle;
  document.getElementById('add-step-btn').textContent = t.addStepBtn;
  document.getElementById('steps-help').textContent = t.stepsHelp;
  document.getElementById('newStepName').placeholder = t.stepNamePlaceholder;
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  document.getElementById('info-title').textContent = t.infoTitle;
  document.getElementById('energy-wheel-title').textContent = t.energyWheelTitle;
  document.getElementById('energy-help').textContent = t.energyHelp;
  document.getElementById('hierarchy-title').textContent = t.hierarchyTitle;
  
  // –ú–∞—Ç—Ä–∏—Ü–∞
  document.getElementById('matrix-title').textContent = t.matrixTitle;
  document.getElementById('matrix-header-severity').textContent = t.matrixSeverity;
  document.getElementById('matrix-desc-a').textContent = t.matrixA;
  document.getElementById('matrix-desc-b').textContent = t.matrixB;
  document.getElementById('matrix-desc-c').textContent = t.matrixC;
  document.getElementById('matrix-desc-d').textContent = t.matrixD;
  document.getElementById('matrix-desc-e').textContent = t.matrixE;
  document.getElementById('legend-low').textContent = t.legendLow;
  document.getElementById('legend-medium').textContent = t.legendMedium;
  document.getElementById('legend-high').textContent = t.legendHigh;
  
  // –†–µ–µ—Å—Ç—Ä
  document.getElementById('registry-title').textContent = t.registryTitle;
  document.getElementById('registry-help').textContent = t.registryHelp;
  t.registryCols.forEach((col, i) => {
    document.getElementById(`registry-col${i+1}`).textContent = col;
  });
  
  // –≠–∫—Å–ø–æ—Ä—Ç
  document.getElementById('export-title').textContent = t.exportTitle;
  document.getElementById('analytics-title').textContent = t.analyticsTitle;
  document.getElementById('export-excel-btn').textContent = t.exportExcelBtn;
  document.getElementById('clear-all-btn').textContent = t.clearAllBtn;
  document.getElementById('export-help').textContent = t.exportHelp;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-lang') === lang) {
      btn.classList.add('active');
    }
  });
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ì–ª–∞–≤–Ω–∞—è"
  updateHomeButtonLanguage();
  
  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –Ω–æ–≤—ã–º —è–∑—ã–∫–æ–º
  renderStepsUI();
  updateRegistryTable();
  renderEnergyList();
  renderHierarchyPanel();
  renderMatrix();
  updateAnalytics();
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ "–ì–ª–∞–≤–Ω–∞—è"
function updateHomeButtonLanguage() {
  const t = TRANSLATIONS[currentLang];
  document.getElementById('home-button-text').textContent = t.homeButtonText;
}

/* ===========================
   Data
   =========================== */

const ENERGIES = [
  { key: 'Gravity', ru: '–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è', en: 'Gravity', kz: '–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è', description: '–°–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è', examples: '–ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –ø–∞–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞' },
  { key: 'Motion', ru: '–î–≤–∏–∂–µ–Ω–∏–µ', en: 'Motion', kz: '“ö–æ–∑“ì–∞–ª—ã—Å', description: '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–µ–ª –∏ –ø–æ—Ç–æ–∫–æ–≤', examples: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ø–æ–¥–≤–∏–∂–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' },
  { key: 'Mechanical', ru: '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è', en: 'Mechanical energy', kz: '–ú–µ—Ö–∞–Ω–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è', description: '–î–≤–∏–∂—É—â–∏–µ—Å—è —á–∞—Å—Ç–∏, —Å–∏–ª–∞', examples: '–≤—Ä–∞—â–µ–Ω–∏–µ, –≤–∏–±—Ä–∞—Ü–∏—è, –∑–∞–∂–∞—Ç–∏–µ' },
  { key: 'Electrical', ru: '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ', en: 'Electrical', kz: '–≠–ª–µ–∫—Ç—Ä', description: '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–µ—Ç–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', examples: '–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –∫–∞–±–µ–ª–∏' },
  { key: 'Pressure', ru: '–î–∞–≤–ª–µ–Ω–∏–µ', en: 'Pressure', kz: '“ö—ã—Å—ã–º', description: '–ì–∞–∑/–∂–∏–¥–∫–æ—Å—Ç—å –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º', examples: '–±–∞–ª–ª–æ–Ω—ã, —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥—ã' },
  { key: 'Temperature', ru: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', en: 'Temperature', kz: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', description: '–ì–æ—Ä—è—á–∏–µ/—Ö–æ–ª–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—ã', examples: '–ø–∞—Ä, –≥–æ—Ä—è—á–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏' },
  { key: 'Chemical', ru: '–•–∏–º–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è', en: 'Chemical energy', kz: '–•–∏–º–∏—è–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è', description: '–û–ø–∞—Å–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞', examples: ' —Ç–æ–∫—Å–∏—á–Ω—ã–µ –ø–∞—Ä—ã, –∫–∏—Å–ª–æ—Ç—ã' },
  { key: 'Biological', ru: '–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è', en: 'Biological energy', kz: '–ë–∏–æ–ª–æ–≥–∏—è–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è', description: '–û—Ä–≥–∞–Ω–∏–∑–º—ã –∏ –±–∏–æ–º–∞—Ç–µ—Ä–∏–∞–ª—ã', examples: '–±–∞–∫—Ç–µ—Ä–∏–∏, –∂–∏–≤–æ—Ç–Ω—ã–µ' },
  { key: 'Radiation', ru: '–†–∞–¥–∏–∞—Ü–∏—è', en: 'Radiation', kz: '–†–∞–¥–∏–∞—Ü–∏—è', description: '–ò–∑–ª—É—á–µ–Ω–∏–µ', examples: '–ª–∞–∑–µ—Ä—ã, —Ä–µ–Ω—Ç–≥–µ–Ω' },
  { key: 'Sound', ru: '–ó–≤—É–∫', en: 'Sound', kz: '–î—ã–±—ã—Å', description: '–®—É–º –∏ —É–¥–∞—Ä–Ω—ã–µ –≤–æ–ª–Ω—ã', examples: '—à—É–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è' },
  { key: 'Ergonomics', ru: '–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞', en: 'Ergonomics', kz: '–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞', description: '–ü–æ–∑–∞, –ø–æ–¥—ä–µ–º—ã, –ø–æ–≤—Ç–æ—Ä', examples: '–ø–æ–¥—ä–µ–º —Ç—è–∂–µ—Å—Ç–µ–π' },
  { key: 'Psychological', ru: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã', en: 'Psychological factors', kz: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä', description: '–°—Ç—Ä–µ—Å—Å –∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã', examples: '—Å—Ç—Ä–µ—Å—Å, —É—Å—Ç–∞–ª–æ—Å—Ç—å' }
];

// –ò–µ—Ä–∞—Ä—Ö–∏—è –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ TRANSLATIONS
function getHierarchyControls() {
  return TRANSLATIONS[currentLang].hierarchy;
}

const CONSEQUENCE_SUGGESTIONS_BY_ENERGY = {
  Gravity: ["–ü–∞–¥–µ–Ω–∏–µ ‚Äî —Ç—Ä–∞–≤–º–∞ –≥–æ–ª–æ–≤—ã, –ø–µ—Ä–µ–ª–æ–º","–ü–∞–¥–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ ‚Äî —É—à–∏–±, –ø–µ—Ä–µ–ª–æ–º"],
  Electrical: ["–ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º ‚Äî –æ–∂–æ–≥, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–¥—Ü–∞","–ö–æ—Ä–æ—Ç–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ ‚Äî –ø–æ–∂–∞—Ä"],
  Chemical: ["–•–∏–º–∏—á–µ—Å–∫–∏–π –æ–∂–æ–≥ ‚Äî –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∫–æ–∂–∏, –∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è"],
  Mechanical: ["–ó–∞–∂–∞—Ç–∏–µ ‚Äî –ø–µ—Ä–µ–ª–æ–º, –∞–º–ø—É—Ç–∞—Ü–∏—è","–£–¥–∞—Ä –¥–≤–∏–∂—É—â–∏–º—Å—è —ç–ª–µ–º–µ–Ω—Ç–æ–º ‚Äî —Ç—Ä–∞–≤–º–∞"],
  Temperature: ["–û–∂–æ–≥ ‚Äî –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∫–æ–∂–∏","–û–∂–æ–≥ –ø–∞—Ä–æ–º ‚Äî —Ç–µ—Ä–º–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–≤–º—ã"],
  Pressure: ["–†–∞–∑—Ä—ã–≤ —Å–æ—Å—É–¥–∞ ‚Äî –æ—Å–∫–æ–ª–∫–∏, —Ä–∞–∑–ª–∏–≤ –≥–æ—Ä—è—á–µ–π/—Ç–æ–∫—Å–∏—á–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏"],
  Biological: ["–ò–Ω—Ñ–µ–∫—Ü–∏—è ‚Äî –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞"],
  Radiation: ["–ò–∑–ª—É—á–µ–Ω–∏–µ ‚Äî –æ–∂–æ–≥, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã"],
  Sound: ["–ü–æ—Ç–µ—Ä—è —Å–ª—É—Ö–∞ ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã"],
  Ergonomics: ["–¢–µ–Ω–¥–∏–Ω–∏—Ç, –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ"],
  Psychological: ["–°—Ç—Ä–µ—Å—Å ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è, –æ—à–∏–±–∫–∏"],
  Motion: ["–ù–∞–µ–∑–¥/—Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ ‚Äî —Ç—Ä–∞–≤–º—ã"],
  default: ["–¢—Ä–∞–≤–º–∞ ‚Äî —É—à–∏–±, –ø–µ—Ä–µ–ª–æ–º","–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è","–ü–æ–∂–∞—Ä ‚Äî –æ–∂–æ–≥–∏, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏"]
};

// –£—Ä–æ–≤–Ω–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è –∏–∑ TRANSLATIONS
function getConsequenceLevels() {
  return TRANSLATIONS[currentLang].consequenceLevels;
}

// –£—Ä–æ–≤–Ω–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è –∏–∑ TRANSLATIONS
function getProbabilityLevels() {
  return TRANSLATIONS[currentLang].probabilityLevels;
}

/* ===========================
   Matrix definitions (explicit mapping)
   Keys formatted as `${severity}${prob}` e.g. '5A', '3C' etc.
   Each maps to level and description matching your table.
   =========================== */

const MATRIX_DEFS = {
  // 5
  "5A": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
  "5B": { level: "–í—ã—Å–æ–∫–∏–π", note: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
  "5C": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "5D": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "5E": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },

  // 4
  "4A": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
  "4B": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
  "4C": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "4D": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "4E": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },

  // 3
  "3A": { level: "–ù–∏–∑–∫–∏–π", note: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
  "3B": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
  "3C": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "3D": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "3E": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },

  // 2
  "2A": { level: "–ù–∏–∑–∫–∏–π", note: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
  "2B": { level: "–ù–∏–∑–∫–∏–π", note: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
  "2C": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "2D": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "2E": { level: "–í—ã—Å–æ–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },

  // 1
  "1A": { level: "–ù–∏–∑–∫–∏–π", note: "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ" },
  "1B": { level: "–ù–∏–∑–∫–∏–π", note: "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ" },
  "1C": { level: "–ù–∏–∑–∫–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "1D": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" },
  "1E": { level: "–°—Ä–µ–¥–Ω–∏–π", note: "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ" }
};

// –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
function getMatrixNote(severity, probLetter) {
  const t = TRANSLATIONS[currentLang];
  const notes = {
    ru: {
      "A": "–ù–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å –≤ –º–∏—Ä–µ",
      "B": "–†–µ–¥–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–∏—Ä–µ",
      "C": "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–Ω–æ–≥–¥–∞ –≤ –º–∏—Ä–µ, –Ω–æ –Ω–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
      "D": "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ä–µ–¥–∫–æ –≤ –º–∏—Ä–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
      "E": "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ"
    },
    en: {
      "A": "Never occurred worldwide",
      "B": "Rarely occurred worldwide",
      "C": "Occurred sometimes worldwide, but not in Kazakhstan",
      "D": "Rarely occurred worldwide, but regularly in Kazakhstan",
      "E": "Occurs regularly in Kazakhstan"
    },
    kz: {
      "A": "”ò–ª–µ–º–¥–µ –µ—à“õ–∞—à–∞–Ω –±–æ–ª“ì–∞–Ω –∂–æ“õ",
      "B": "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã",
      "C": "”ò–ª–µ–º–¥–µ –∫–µ–π–¥–µ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ –µ–º–µ—Å",
      "D": "”ò–ª–µ–º–¥–µ —Å–∏—Ä–µ–∫ –±–æ–ª–¥—ã, –±—ñ—Ä–∞“õ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ",
      "E": "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ “Ø–Ω–µ–º—ñ –±–æ–ª–∞–¥—ã"
    }
  };
  
  const note = notes[currentLang]?.[probLetter] || "";
  const level = getMatrixInfo(severity, probLetter).level;
  
  // –ü–µ—Ä–µ–≤–æ–¥–∏–º —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
  const levelTranslations = {
    ru: {"–ù–∏–∑–∫–∏–π": "–ù–∏–∑–∫–∏–π", "–°—Ä–µ–¥–Ω–∏–π": "–°—Ä–µ–¥–Ω–∏–π", "–í—ã—Å–æ–∫–∏–π": "–í—ã—Å–æ–∫–∏–π"},
    en: {"–ù–∏–∑–∫–∏–π": "Low", "–°—Ä–µ–¥–Ω–∏–π": "Medium", "–í—ã—Å–æ–∫–∏–π": "High"},
    kz: {"–ù–∏–∑–∫–∏–π": "–¢”©–º–µ–Ω", "–°—Ä–µ–¥–Ω–∏–π": "–û—Ä—Ç–∞—à–∞", "–í—ã—Å–æ–∫–∏–π": "–ñ–æ“ì–∞—Ä—ã"}
  };
  
  const translatedLevel = levelTranslations[currentLang]?.[level] || level;
  
  return { level: translatedLevel, note: note };
}

function getMatrixInfo(severity, probLetter){
  const key = `${severity}${probLetter}`;
  return MATRIX_DEFS[key] || { level: "–ù/–î", note: "" };
}

/* ===========================
   State & storage
   =========================== */
const STORAGE_KEY = 'qhs_risk_assessment_v2_final_matrix';
let state = { steps: [], assessments: [] };

/* ===========================
   Helpers
   =========================== */
const $ = id => document.getElementById(id);
function uid(prefix='id'){ return prefix + '_' + Date.now().toString(36) + Math.floor(Math.random()*999).toString(36); }
function notify(msg, type='info'){
  const n = $('notif'); n.textContent = msg; n.className = 'notification'; n.style.borderLeft = '4px solid ' + (type==='success'?'#16a34a':(type==='error'?'#ef4444':(type==='warn'?'#f59e0b':'var(--accent)')));
  n.classList.remove('hidden'); setTimeout(()=>n.classList.add('hidden'), 2600);
}
function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* ===========================
   Initialization
   =========================== */
document.addEventListener('DOMContentLoaded', init);

function init(){
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–∑—ã–∫–æ–≤—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const lang = e.target.getAttribute('data-lang');
      changeLanguage(lang);
    });
  });
  
  renderEnergyList();
  renderHierarchyPanel();
  bindTabs();
  loadFromLocal();
  renderStepsUI();
  renderMatrix();
  updateRegistryTable();
  updateAnalytics();
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ì–ª–∞–≤–Ω–∞—è"
  setupHomeButton();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
  showTab('tab-steps');
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ì–ª–∞–≤–Ω–∞—è" */
function setupHomeButton() {
  const homeBtn = document.getElementById('home-button');
  if(homeBtn) {
    const link = homeBtn.querySelector('a');
    link.addEventListener('mouseenter', () => {
      homeBtn.style.transform = 'translateY(-2px)';
      link.style.boxShadow = '0 6px 16px rgba(11,77,182,0.3)';
      link.style.background = 'var(--accent-2)';
    });
    link.addEventListener('mouseleave', () => {
      homeBtn.style.transform = 'translateY(0)';
      link.style.boxShadow = '0 4px 12px rgba(11,77,182,0.2)';
      link.style.background = 'var(--accent)';
    });
  }
  
  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  function adjustHomeButtonForMobile() {
    if (window.innerWidth < 768) {
      homeBtn.style.bottom = '15px';
      homeBtn.style.right = '15px';
      if(homeBtn.querySelector('a')) {
        homeBtn.querySelector('a').style.padding = '6px 10px';
      }
    } else {
      homeBtn.style.bottom = '20px';
      homeBtn.style.right = '20px';
      if(homeBtn.querySelector('a')) {
        homeBtn.querySelector('a').style.padding = '8px 14px';
      }
    }
  }
  
  window.addEventListener('resize', adjustHomeButtonForMobile);
  adjustHomeButtonForMobile();
}

/* Tabs */
function bindTabs(){
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', (e) => {
      const tabId = e.target.getAttribute('data-tab');
      showTab(tabId);
    });
  });
}

function showTab(tabId) {
  // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.add('hidden');
  });
  
  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–∞–Ω–µ–ª—å
  document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
  $(tabId).classList.remove('hidden');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
  if(tabId === 'tab-registry') updateRegistryTable();
  if(tabId === 'tab-steps') renderStepsUI();
  if(tabId === 'tab-info') {
    renderEnergyList();
    renderHierarchyPanel();
  }
  if(tabId === 'tab-export') updateAnalytics();
}

/* Steps */
function addStep(){
  const name = $('newStepName').value.trim();
  const t = TRANSLATIONS[currentLang];
  if(!name){ notify(t.enterStepName,'warn'); return; }
  const step = {id: uid('step'), name, desc: ''};
  state.steps.push(step);
  $('newStepName').value='';
  saveToLocal(false); 
  renderStepsUI(); 
  notify(t.stepAdded,'success');
}

function removeStep(stepId){
  const t = TRANSLATIONS[currentLang];
  if(!confirm(t.removeStepConfirm)) return;
  state.steps = state.steps.filter(s=>s.id!==stepId);
  state.assessments = state.assessments.filter(a=>a.stepId!==stepId);
  saveToLocal(false); 
  renderStepsUI(); 
  updateRegistryTable(); 
  updateAnalytics(); 
  notify(t.stepRemoved,'success');
}

function editStep(stepId){
  const step = state.steps.find(s=>s.id===stepId);
  const t = TRANSLATIONS[currentLang];
  if(!step) return;
  const newName = prompt(t.stepNamePrompt, step.name);
  if(newName!==null) step.name=newName;
  const newDesc = prompt(t.stepDescPrompt, step.desc||'');
  if(newDesc!==null) step.desc=newDesc;
  saveToLocal(false); 
  renderStepsUI();
}

function renderStepsUI(){
  const container = $('stepsContainer'); 
  container.innerHTML='';
  const t = TRANSLATIONS[currentLang];
  
  if (state.steps.length === 0) {
    container.innerHTML = `<div class="small" style="text-align:center;padding:20px;color:var(--muted)">${t.noSteps}</div>`;
    return;
  }
  
  state.steps.forEach((step, idx)=>{
    const card = document.createElement('div'); 
    card.className='step-card';
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>${idx+1}. ${escapeHtml(step.name)}</strong>
          <div class="small">${escapeHtml(step.desc||'')}</div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn primary small" onclick="openStepPanel('${step.id}')">${t.analyzeBtn}</button>
          <button class="btn small ghost" onclick="editStep('${step.id}')">${t.editBtn}</button>
          <button class="btn small ghost" onclick="removeStep('${step.id}')">${t.deleteBtn}</button>
        </div>
      </div>
      <div id="step_panel_${step.id}" class="collapsible hidden" style="margin-top:8px"></div>
    `;
    container.appendChild(card);
  });
}

/* Step panel -> per energy add/edit */
function openStepPanel(stepId){
  const panel = $(`step_panel_${stepId}`);
  if(!panel) return;
  panel.classList.toggle('hidden');
  if(!panel.classList.contains('hidden')) renderStepPanel(stepId);
}

function renderStepPanel(stepId){
  const panel = $(`step_panel_${stepId}`); 
  if(!panel) return;
  panel.innerHTML = '';
  const step = state.steps.find(s=>s.id===stepId); 
  if(!step) return;
  const t = TRANSLATIONS[currentLang];
  
  panel.appendChild(Object.assign(document.createElement('div'), { 
    innerHTML:`<div class="small">${t.stepsTitle.split('üìã')[1] || '–®–∞–≥'}: <strong>${escapeHtml(step.name)}</strong> ‚Äî ${t.addAssessmentBtn}</div>` 
  }));
  
  ENERGIES.forEach(en=>{
    const existing = state.assessments.find(a=>a.stepId===stepId && a.energyKey===en.key);
    const wrapper = document.createElement('div'); 
    wrapper.style.marginTop='8px';
    wrapper.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>${en[currentLang]}</strong> <span class="small">(${en.key})</span></div>
        <div style="display:flex;gap:6px">
          <button class="btn primary small" onclick="openAssessmentEditor('${stepId}','${en.key}')">
            ${existing ? t.editAssessmentBtn : t.addAssessmentBtn}
          </button>
          ${existing ? `<button class="btn small ghost" onclick="removeAssessment('${existing.id}')">${t.removeAssessmentBtn}</button>` : ''}
        </div>
      </div>
    `;
    panel.appendChild(wrapper);
  });
}

/* Assessments editor */
function openAssessmentEditor(stepId, energyKey){
  const step = state.steps.find(s=>s.id===stepId);
  const en = ENERGIES.find(e=>e.key===energyKey);
  const existing = state.assessments.find(a=>a.stepId===stepId && a.energyKey===energyKey);
  const t = TRANSLATIONS[currentLang];

  const formId = uid('form');
  const form = document.createElement('div'); 
  form.className='collapsible'; 
  form.style.position='relative';
  form.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div><strong>${t.addAssessmentBtn}: ${escapeHtml(step.name)} ‚Äî ${escapeHtml(en[currentLang])}</strong></div>
      <div><button class="btn small primary" id="${formId}_close">${t.closeBtn}</button></div>
    </div>

    <div class="risk-assessment-grid">
      <div>
        <label>${t.hazardLabel}</label>
        <textarea id="${formId}_hazard" class="wide-textarea" placeholder="${t.hazardPlaceholder}">${en[currentLang]} ‚Äî ${t.hazardLabel.toLowerCase()}</textarea>
        <label style="margin-top:8px">${t.consequenceLabel}</label>
        <textarea id="${formId}_consequence" class="wide-textarea" placeholder="${t.consequenceLabel}">${existing?.consequence || ''}</textarea>
        <div style="margin-top:12px">
          <label>${t.proactiveLabel}</label>
          <div id="${formId}_pre_barriers"></div>
          <div style="display:flex;gap:8px;margin-top:6px">
            <textarea id="${formId}_pre_add" placeholder="${t.preBarrierPlaceholder}" class="barrier-textarea"></textarea>
            <button class="btn small primary" onclick="addBarrierToForm('${formId}','pre')">${t.addBarrierBtn}</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <label>${t.reactiveLabel}</label>
          <div id="${formId}_post_barriers"></div>
          <div style="display:flex;gap:8px;margin-top:6px">
            <textarea id="${formId}_post_add" placeholder="${t.postBarrierPlaceholder}" class="barrier-textarea"></textarea>
            <button class="btn small primary" onclick="addBarrierToForm('${formId}','post')">${t.addBarrierBtn}</button>
          </div>
        </div>
      </div>

      <div>
        <label>${t.severityLabel}</label>
        <select id="${formId}_prim_cons">
          ${getConsequenceLevels().map(c=>`<option value="${c.level}">${c.level} - ${c.description}</option>`).join('')}
        </select>

        <label style="margin-top:8px">${t.probabilityLabel}</label>
        <select id="${formId}_prim_prob">
          ${getProbabilityLevels().map(p=>`<option value="${p.level}">${p.label}</option>`).join('')}
        </select>

        <div style="margin-top:12px; padding:10px; background:#f8f9fa; border-radius:6px;">
          <strong>${t.calculatedRisk}</strong>
          <div id="${formId}_risk_result" style="margin-top:4px; font-weight:bold"></div>
          <div id="${formId}_risk_level" style="font-size:12px; color:#6c757d"></div>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn primary" id="${formId}_save">${t.saveRiskBtn}</button>
          <button class="btn ghost" id="${formId}_apply_preset">${t.autoBarriersBtn}</button>
        </div>
      </div>
    </div>

    <div id="${formId}_residual_section" style="margin-top:12px">
      <div class="residual-risk-section">
        <h4>${t.residualTitle}</h4>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <label>${t.residualSeverity}</label>
            <select id="${formId}_res_cons">
              ${getConsequenceLevels().map(c=>`<option value="${c.level}">${c.level} - ${c.description}</option>`).join('')}
            </select>
          </div>
          <div>
            <label>${t.residualProbability}</label>
            <select id="${formId}_res_prob">
              ${getProbabilityLevels().map(p=>`<option value="${p.level}">${p.label}</option>`).join('')}
            </select>
          </div>
        </div>

        <div style="margin-top:12px; padding:10px; background:#e9ecef; border-radius:6px;">
          <strong>${t.residualRisk}</strong>
          <div id="${formId}_res_risk_result" style="margin-top:6px; font-weight:bold"></div>
          <div id="${formId}_res_risk_level" style="font-size:12px; color:#6c757d"></div>
        </div>

        <div style="margin-top:8px">
          <button class="btn primary" id="${formId}_save_res">${t.saveResidualBtn}</button>
        </div>
      </div>
    </div>
  `;

  const panel = $(`step_panel_${stepId}`);
  const prev = panel.querySelector('.collapsible[data-form-active]');
  if(prev) prev.remove();
  form.setAttribute('data-form-active','1');
  panel.appendChild(form);

  // populate datalist for this energy
  populateConsequenceDatalistForEnergy(energyKey);

  // render barriers if existing
  renderBarriersInForm(formId, existing);

  // fill existing values
  if(existing){
    $(`${formId}_hazard`).value = existing.hazardName || `${en[currentLang]} ‚Äî ${t.hazardLabel.toLowerCase()}`;
    $(`${formId}_consequence`).value = existing.consequence || '';
    $(`${formId}_prim_prob`).value = existing.primary?.prob || 'C';
    $(`${formId}_prim_cons`).value = existing.primary?.cons || 3;
    if(existing.residual){
      $(`${formId}_res_prob`).value = existing.residual.prob;
      $(`${formId}_res_cons`).value = existing.residual.cons;
      updateResidualRiskCalculation(formId);
    }
  }

  // initial calculations
  updateRiskCalculation(formId);
  updateResidualRiskCalculation(formId);

  // events
  $(`${formId}_prim_prob`).addEventListener('change', ()=> updateRiskCalculation(formId));
  $(`${formId}_prim_cons`).addEventListener('change', ()=> updateRiskCalculation(formId));
  $(`${formId}_res_prob`).addEventListener('change', ()=> updateResidualRiskCalculation(formId));
  $(`${formId}_res_cons`).addEventListener('change', ()=> updateResidualRiskCalculation(formId));

  $(`${formId}_close`).onclick = ()=> form.remove();

  $(`${formId}_apply_preset`).onclick = ()=>{
    const presets = {
      Gravity: ['–°—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ','–û–≥—Ä–∞–∂–¥–µ–Ω–∏—è'],
      Motion: ['–°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è','–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏'],
      Mechanical: ['–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è','–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞'],
      Electrical: ['LOTO','–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏'],
      Pressure: ['–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–≤–ª–µ–Ω–∏—è','–ó–∞—â–∏—Ç–Ω—ã–µ –∫–ª–∞–ø–∞–Ω—ã'],
      Temperature: ['–ò–∑–æ–ª—è—Ü–∏—è','–¢–µ–ø–ª–æ–∑–∞—â–∏—Ç–∞'],
      Chemical: ['–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è','–°–ò–ó –¥–ª—è —Ö–∏–º–∏–∏'],
      Biological: ['–°–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞','–ò–∑–æ–ª—è—Ü–∏—è –∑–æ–Ω—ã'],
      Radiation: ['–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ','–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞'],
      Sound: ['–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è','–®—É–º–æ–∑–∞—â–∏—Ç–Ω—ã–µ –∫–æ–∂—É—Ö–∏'],
      Ergonomics: ['–≠—Ä–≥–æ–Ω–æ–º–∏—á–Ω–∞—è –º–µ–±–µ–ª—å','–†–æ—Ç–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞'],
      Psychological: ['–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞','–û–±—É—á–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É']
    };
    const list = presets[energyKey] || CONSEQUENCE_SUGGESTIONS_BY_ENERGY.default;
    list.forEach(b => addBarrierToForm(formId,'pre',b));
    addBarrierToForm(formId,'post','–ü–ª–∞–Ω –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∞–≤–∞—Ä–∏–π');
  };

  $(`${formId}_save`).onclick = ()=>{
    const hazardName = $(`${formId}_hazard`).value.trim() || `${en[currentLang]} ‚Äî ${t.hazardLabel.toLowerCase()}`;
    const consequence = $(`${formId}_consequence`).value.trim();
    if(!consequence){ alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ (–∫ —á–µ–º—É –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç—å)'); return; }
    const prob = $(`${formId}_prim_prob`).value;
    const cons = parseInt($(`${formId}_prim_cons`).value);
    const preBarriers = getBarriersFromForm(formId,'pre');
    const postBarriers = getBarriersFromForm(formId,'post');
    const code = `${cons}${prob}`;
    const matrixInfo = getMatrixNote(cons, prob);
    const level = matrixInfo.level;

    if(existing){
      existing.hazardName = hazardName;
      existing.consequence = consequence;
      existing.primary = {prob,cons,code,level};
      existing.preBarriers = preBarriers.barriers;
      existing.preHierarchy = preBarriers.hierarchies;
      existing.postBarriers = postBarriers.barriers;
      existing.postHierarchy = postBarriers.hierarchies;
    } else {
      const a = { 
        id: uid('ass'), 
        stepId, 
        energyKey, 
        hazardName, 
        consequence, 
        primary: {prob,cons,code,level}, 
        preBarriers: preBarriers.barriers, 
        preHierarchy: preBarriers.hierarchies, 
        postBarriers: postBarriers.barriers, 
        postHierarchy: postBarriers.hierarchies, 
        residual: null 
      };
      state.assessments.push(a);
    }
    saveToLocal(false); 
    renderStepPanel(stepId); 
    updateRegistryTable(); 
    updateAnalytics(); 
    notify('–û—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞','success');
    form.remove();
  };

  $(`${formId}_save_res`).onclick = ()=>{
    const rprob = $(`${formId}_res_prob`).value;
    const rcons = parseInt($(`${formId}_res_cons`).value);
    const rcode = `${rcons}${rprob}`;
    const matrixInfo = getMatrixNote(rcons, rprob);
    const rlevel = matrixInfo.level;

    let a = state.assessments.find(a=>a.stepId===stepId && a.energyKey===energyKey);
    if(!a){
      const prob = $(`${formId}_prim_prob`).value;
      const cons = parseInt($(`${formId}_prim_cons`).value);
      const preBarriers = getBarriersFromForm(formId,'pre');
      const postBarriers = getBarriersFromForm(formId,'post');
      const matrixInfoPrim = getMatrixNote(cons, prob);
      a = { 
        id: uid('ass'), 
        stepId, 
        energyKey, 
        hazardName: $(`${formId}_hazard`).value || `${en[currentLang]} ‚Äî ${t.hazardLabel.toLowerCase()}`, 
        consequence: $(`${formId}_consequence`).value || '', 
        primary: {prob,cons,code:`${cons}${prob}`, level: matrixInfoPrim.level}, 
        preBarriers: preBarriers.barriers, 
        preHierarchy: preBarriers.hierarchies, 
        postBarriers: postBarriers.barriers, 
        postHierarchy: postBarriers.hierarchies, 
        residual: null
      };
      state.assessments.push(a);
    }
    a.residual = {prob: rprob, cons: rcons, code: rcode, level: rlevel};
    saveToLocal(false); 
    updateRegistryTable(); 
    updateAnalytics(); 
    notify('–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ä–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω','success');
    form.remove();
  };
}

/* calculations display */
function updateRiskCalculation(formId){
  const prob = $(`${formId}_prim_prob`).value;
  const cons = parseInt($(`${formId}_prim_cons`).value);
  const info = getMatrixNote(cons, prob);
  const display = `${cons}${prob} - ${info.level || '–ù/–î'}`;
  $(`${formId}_risk_result`).textContent = display;
  
  // –¶–≤–µ—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π —Ä–∏—Å–∫–∞
  const levelColors = {
    ru: {"–ù–∏–∑–∫–∏–π": "var(--low)", "–°—Ä–µ–¥–Ω–∏–π": "var(--medium)", "–í—ã—Å–æ–∫–∏–π": "var(--high)"},
    en: {"Low": "var(--low)", "Medium": "var(--medium)", "High": "var(--high)"},
    kz: {"–¢”©–º–µ–Ω": "var(--low)", "–û—Ä—Ç–∞—à–∞": "var(--medium)", "–ñ–æ“ì–∞—Ä—ã": "var(--high)"}
  };
  
  $(`${formId}_risk_result`).style.color = levelColors[currentLang]?.[info.level] || 'var(--muted)';
  
  let treatment = '';
  if(info.level==='–í—ã—Å–æ–∫–∏–π' || info.level==='High' || info.level==='–ñ–æ“ì–∞—Ä—ã') {
    treatment = '–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ Bow-Tie –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞—Ä—å–µ—Ä–æ–≤';
  } else if(info.level==='–°—Ä–µ–¥–Ω–∏–π' || info.level==='Medium' || info.level==='–û—Ä—Ç–∞—à–∞') {
    treatment = '–¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è';
  } else {
    treatment = '–£–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è';
  }
  $(`${formId}_risk_level`).textContent = treatment;
}

function updateResidualRiskCalculation(formId){
  const rprob = $(`${formId}_res_prob`).value;
  const rcons = parseInt($(`${formId}_res_cons`).value);
  const info = getMatrixNote(rcons, rprob);
  $(`${formId}_res_risk_result`).textContent = `${rcons}${rprob} - ${info.level || '–ù/–î'}`;
  
  // –¶–≤–µ—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π —Ä–∏—Å–∫–∞
  const levelColors = {
    ru: {"–ù–∏–∑–∫–∏–π": "var(--low)", "–°—Ä–µ–¥–Ω–∏–π": "var(--medium)", "–í—ã—Å–æ–∫–∏–π": "var(--high)"},
    en: {"Low": "var(--low)", "Medium": "var(--medium)", "High": "var(--high)"},
    kz: {"–¢”©–º–µ–Ω": "var(--low)", "–û—Ä—Ç–∞—à–∞": "var(--medium)", "–ñ–æ“ì–∞—Ä—ã": "var(--high)"}
  };
  
  $(`${formId}_res_risk_result`).style.color = levelColors[currentLang]?.[info.level] || 'var(--muted)';
  
  let treatment = '';
  if(info.level==='–í—ã—Å–æ–∫–∏–π' || info.level==='High' || info.level==='–ñ–æ“ì–∞—Ä—ã') {
    treatment = '–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ Bow-Tie –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞—Ä—å–µ—Ä–æ–≤';
  } else if(info.level==='–°—Ä–µ–¥–Ω–∏–π' || info.level==='Medium' || info.level==='–û—Ä—Ç–∞—à–∞') {
    treatment = '–¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è';
  } else {
    treatment = '–£–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è';
  }
  $(`${formId}_res_risk_level`).textContent = treatment;
}

/* Barriers helpers */
function renderBarriersInForm(formId, assessment){
  const preBarriers = assessment?.preBarriers || [];
  const preHierarchy = assessment?.preHierarchy || [];
  const postBarriers = assessment?.postBarriers || [];
  const postHierarchy = assessment?.postHierarchy || [];
  const preContainer = $(`${formId}_pre_barriers`);
  const postContainer = $(`${formId}_post_barriers`);
  if(!preContainer || !postContainer) return;
  preContainer.innerHTML = ''; 
  postContainer.innerHTML = '';
  
  const hierarchy = getHierarchyControls();
  
  preBarriers.forEach((barrier,index)=>{
    const div = document.createElement('div'); 
    div.className='barrier-with-hierarchy';
    div.innerHTML = `
      <textarea class="barrier-text barrier-textarea">${escapeHtml(barrier)}</textarea>
      <select class="hierarchy-select">
        <option value="">‚Äî ${currentLang === 'en' ? 'Select hierarchy' : currentLang === 'kz' ? '–ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é'} ‚Äî</option>
        ${hierarchy.map(h=>`<option value="${h.level}" ${preHierarchy[index]===h.level?'selected':''}>${h.level}</option>`).join('')}
      </select>
      <button class="btn small ghost" onclick="this.parentElement.remove()">√ó</button>
    `;
    preContainer.appendChild(div);
  });
  
  postBarriers.forEach((barrier,index)=>{
    const div = document.createElement('div'); 
    div.className='barrier-with-hierarchy';
    div.innerHTML = `
      <textarea class="barrier-text barrier-textarea">${escapeHtml(barrier)}</textarea>
      <select class="hierarchy-select">
        <option value="">‚Äî ${currentLang === 'en' ? 'Select hierarchy' : currentLang === 'kz' ? '–ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é'} ‚Äî</option>
        ${hierarchy.map(h=>`<option value="${h.level}" ${postHierarchy[index]===h.level?'selected':''}>${h.level}</option>`).join('')}
      </select>
      <button class="btn small ghost" onclick="this.parentElement.remove()">√ó</button>
    `;
    postContainer.appendChild(div);
  });
}

function addBarrierToForm(formId, type, presetText=null){
  const container = $(`${formId}_${type}_barriers`);
  const input = $(`${formId}_${type}_add`);
  const text = presetText || (input ? input.value.trim() : '');
  if(!text){ notify('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–∞—Ä—å–µ—Ä–∞','warn'); return; }
  const div = document.createElement('div'); 
  div.className='barrier-with-hierarchy';
  const hierarchy = getHierarchyControls();
  div.innerHTML = `
    <textarea class="barrier-text barrier-textarea">${escapeHtml(text)}</textarea>
    <select class="hierarchy-select">
      <option value="">‚Äî ${currentLang === 'en' ? 'Select hierarchy' : currentLang === 'kz' ? '–ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é'} ‚Äî</option>
      ${hierarchy.map(h=>`<option value="${h.level}">${h.level}</option>`).join('')}
    </select>
    <button class="btn small ghost" onclick="this.parentElement.remove()">√ó</button>
  `;
  container.appendChild(div);
  if(!presetText && input) input.value='';
}

function getBarriersFromForm(formId, type){
  const container = $(`${formId}_${type}_barriers`);
  const barriers=[], hierarchies=[];
  if(!container) return {barriers:[], hierarchies:[]};
  container.querySelectorAll('.barrier-with-hierarchy').forEach(div=>{
    const txt = div.querySelector('.barrier-text');
    const sel = div.querySelector('.hierarchy-select');
    if(txt && txt.value.trim()){ 
      barriers.push(txt.value.trim()); 
      hierarchies.push(sel?sel.value:''); 
    }
  });
  return {barriers,hierarchies};
}

/* Remove assessment */
function removeAssessment(assId){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ü–µ–Ω–∫—É?')) return;
  state.assessments = state.assessments.filter(a=>a.id!==assId);
  saveToLocal(false); 
  renderStepsUI(); 
  updateRegistryTable(); 
  updateAnalytics(); 
  notify('–û—Ü–µ–Ω–∫–∞ —É–¥–∞–ª–µ–Ω–∞','success');
}

/* Render energy list */
function renderEnergyList(){
  const el = $('energyList'); 
  el.innerHTML='';
  const t = TRANSLATIONS[currentLang];
  const examplesText = currentLang === 'en' ? 'Examples:' : currentLang === 'kz' ? '–ú—ã—Å–∞–ª–¥–∞—Ä:' : '–ü—Ä–∏–º–µ—Ä—ã:';
  
  ENERGIES.forEach(e=>{
    const d = document.createElement('div'); 
    d.className='energy-item';
    d.innerHTML = `
      <div class="energy-name">${e[currentLang]}</div>
      <div class="energy-description">${e.description}</div>
      <div class="energy-description"><strong>${examplesText}</strong> ${e.examples}</div>
    `;
    el.appendChild(d);
  });
}

/* Registry table rendering */
function updateRegistryTable(){
  const tbody = document.querySelector('#registryTable tbody'); 
  tbody.innerHTML='';
  const t = TRANSLATIONS[currentLang];
  
  if (state.assessments.length === 0) {
    tbody.innerHTML = `<tr><td colspan="13" style="text-align:center;padding:20px;color:var(--muted)">${t.noAssessments}</td></tr>`;
    return;
  }
  
  state.assessments.forEach((a,i)=>{
    const step = state.steps.find(s=>s.id===a.stepId);
    const energy = ENERGIES.find(e=>e.key===a.energyKey);
    const primary = a.primary || {prob:'C',cons:3,code:'3C',level:'–°—Ä–µ–¥–Ω–∏–π'};
    const residual = a.residual || null;
    
    const proactiveBarriers = (a.preBarriers||[]).join('; ');
    const proactiveHierarchy = (a.preHierarchy||[]).join('; ');
    const reactiveBarriers = (a.postBarriers||[]).join('; ');
    const reactiveHierarchy = (a.postHierarchy||[]).join('; ');
    
    const tr = document.createElement('tr'); 
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${step?escapeHtml(step.name):'‚Äî'}</td>
      <td>${energy?energy[currentLang]:a.energyKey}</td>
      <td>${escapeHtml(a.hazardName||'‚Äî')}</td>
      <td>${escapeHtml(a.consequence||'‚Äî')}</td>
      <td>${primary.prob}${primary.cons}</td>
      <td>${primary.level}</td>
      <td>${escapeHtml(proactiveBarriers)}</td>
      <td>${escapeHtml(proactiveHierarchy)}</td>
      <td>${escapeHtml(reactiveBarriers)}</td>
      <td>${escapeHtml(reactiveHierarchy)}</td>
      <td>${residual? (residual.prob+''+residual.cons) : '‚Äî'}</td>
      <td>${residual? residual.level : '‚Äî'}</td>`;
    tr.addEventListener('click', ()=> openAssessmentEditor(a.stepId, a.energyKey));
    tbody.appendChild(tr);
  });
}

/* Hierarchy panel render */
function renderHierarchyPanel(){
  const panel = $('hierarchyPanel'); 
  panel.innerHTML='';
  const hierarchy = getHierarchyControls();
  
  hierarchy.forEach(h=>{
    const d = document.createElement('div'); 
    d.className='small'; 
    d.style.marginBottom='6px';
    d.innerHTML = `
      <strong>${escapeHtml(h.level)}</strong>
      <div class="hierarchy-description">${escapeHtml(h.description)}</div>
    `;
    panel.appendChild(d);
  });
}

/* Analytics */
function updateAnalytics(){
  const total = state.assessments.length;
  
  // –£—á–∏—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ —É—Ä–æ–≤–Ω–µ–π —Ä–∏—Å–∫–∞
  const highKeywords = {
    ru: ["–í—ã—Å–æ–∫–∏–π"],
    en: ["High"],
    kz: ["–ñ–æ“ì–∞—Ä—ã"]
  };
  
  const mediumKeywords = {
    ru: ["–°—Ä–µ–¥–Ω–∏–π"],
    en: ["Medium"],
    kz: ["–û—Ä—Ç–∞—à–∞"]
  };
  
  const lowKeywords = {
    ru: ["–ù–∏–∑–∫–∏–π"],
    en: ["Low"],
    kz: ["–¢”©–º–µ–Ω"]
  };
  
  const high = state.assessments.filter(a => {
    const level = a.primary?.level || '';
    return highKeywords[currentLang].includes(level);
  }).length;
  
  const medium = state.assessments.filter(a => {
    const level = a.primary?.level || '';
    return mediumKeywords[currentLang].includes(level);
  }).length;
  
  const low = state.assessments.filter(a => {
    const level = a.primary?.level || '';
    return lowKeywords[currentLang].includes(level);
  }).length;
  
  const analyticsContainer = $('analyticsStats');
  if(analyticsContainer) {
    const t = TRANSLATIONS[currentLang];
    const totalText = currentLang === 'en' ? 'Total Risks' : currentLang === 'kz' ? '–ë–∞—Ä–ª—ã“õ —Ç”ô—É–µ–∫–µ–ª–¥–µ—Ä' : '–í—Å–µ–≥–æ —Ä–∏—Å–∫–æ–≤';
    
    analyticsContainer.innerHTML = `
      <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:12px;margin-top:12px">
        <div class="stat-card">
          <div class="stat-value">${total}</div>
          <div class="stat-label">${totalText}</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color:var(--low)">${low}</div>
          <div class="stat-label">${t.legendLow}</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color:var(--medium)">${medium}</div>
          <div class="stat-label">${t.legendMedium}</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color:var(--high)">${high}</div>
          <div class="stat-label">${t.legendHigh}</div>
        </div>
      </div>
    `;
  }
}

/* Persistence */
function saveToLocal(show=true){
  try{ 
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); 
    if(show) notify('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage','success'); 
  } catch(e){ 
    console.error(e); 
    notify('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è','error'); 
  }
}

function loadFromLocal(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      const obj = JSON.parse(raw);
      // Add structure validation
      if (!obj.steps) obj.steps = [];
      if (!obj.assessments) obj.assessments = [];
      state = Object.assign({steps: [], assessments: []}, obj);
      notify('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã','success');
    } else {
      // Initialize with default step if empty
      if(state.steps.length===0){ 
        state.steps.push({id:uid('step'), name:'–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞', desc:'–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'}); 
      }
    }
  } catch(e){ 
    console.error(e); 
    state = {steps: [], assessments: []};
    notify('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è','error'); 
  }
}

/* Export to Excel */
function exportExcel(){
  if(state.assessments.length===0){ 
    const t = TRANSLATIONS[currentLang];
    notify(t.noDataExport,'warn'); 
    return; 
  }
  const header = TRANSLATIONS[currentLang].registryCols;
  const aoa = [header];
  state.assessments.forEach((a,i)=>{
    const step = state.steps.find(s=>s.id===a.stepId);
    const en = ENERGIES.find(e=>e.key===a.energyKey);
    const primary = a.primary || {prob:'C',cons:3,code:'3C',level:'–°—Ä–µ–¥–Ω–∏–π'};
    const residual = a.residual || {prob:'',cons:'',code:'',level:''};
    aoa.push([
      i+1,
      step?step.name:'',
      en?en[currentLang]:a.energyKey,
      a.hazardName||'',
      a.consequence||'',
      primary.prob + '' + primary.cons,
      primary.level,
      (a.preBarriers||[]).join('; '),
      (a.preHierarchy||[]).join('; '),
      (a.postBarriers||[]).join('; '),
      (a.postHierarchy||[]).join('; '),
      residual.prob? (residual.prob+''+residual.cons) : '',
      residual.level || ''
    ]);
  });
  const ws = XLSX.utils.aoa_to_sheet(aoa);
  const wb = XLSX.utils.book_new(); 
  XLSX.utils.book_append_sheet(wb, ws, '–†–µ–µ—Å—Ç—Ä —Ä–∏—Å–∫–æ–≤'); 
  XLSX.writeFile(wb, 'Risk_Assessment_Tool_v2_registry.xlsx');
  notify('Excel —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω','success');
}

/* misc */
function clearAll(){ 
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) return; 
  state = {steps:[], assessments:[]}; 
  localStorage.removeItem(STORAGE_KEY); 
  renderStepsUI(); 
  renderMatrix(); 
  updateRegistryTable(); 
  updateAnalytics(); 
  notify('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã','success'); 
}

/* Matrix rendering */
function renderMatrix(){
  const tbody = $('matrixBody');
  tbody.innerHTML = '';

  const t = TRANSLATIONS[currentLang];
  
  // severity rows 5..1 with translations
  const severities = [
    {v:5, label:t.severity5},
    {v:4, label:t.severity4},
    {v:3, label:t.severity3},
    {v:2, label:t.severity2},
    {v:1, label:t.severity1}
  ];

  severities.forEach(row=>{
    const tr = document.createElement('tr');
    const th = document.createElement('th');
    th.className='header';
    th.style.textAlign='left';
    th.innerHTML = `<div style="font-weight:700">${row.v}</div><div class="small">${row.label}</div>`;
    tr.appendChild(th);

    ['A','B','C','D','E'].forEach(col=>{
      const code = `${row.v}${col}`;
      const info = getMatrixNote(row.v, col);
      const td = document.createElement('td');
      const lvl = info.level || '–ù/–î';
      let cls = '';
      if(lvl === '–í—ã—Å–æ–∫–∏–π' || lvl === 'High' || lvl === '–ñ–æ“ì–∞—Ä—ã') cls='risk-high';
      else if(lvl === '–°—Ä–µ–¥–Ω–∏–π' || lvl === 'Medium' || lvl === '–û—Ä—Ç–∞—à–∞') cls='risk-medium';
      else cls='risk-low';
      td.className = cls;
      td.setAttribute('data-code', code);
      td.setAttribute('data-level', lvl);
      td.setAttribute('data-note', info.note || '');
      td.innerHTML = `<span class="matrix-code">${code}</span><span class="matrix-desc">${lvl}</span>`;
      // attach tooltip events
      td.addEventListener('mouseenter', onMatrixCellEnter);
      td.addEventListener('mouseleave', onMatrixCellLeave);
      td.addEventListener('mousemove', onMatrixCellMove);
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });
}

/* tooltip handling */
const tooltip = $('matrixTooltip');
let tooltipTimeout = null;

function onMatrixCellEnter(e){
  const td = e.currentTarget;
  const code = td.getAttribute('data-code');
  const level = td.getAttribute('data-level');
  const note = td.getAttribute('data-note');
  const html = `<div style="font-weight:700;margin-bottom:6px">${code} ‚Äî ${level} ${currentLang === 'en' ? 'risk' : currentLang === 'kz' ? '—Ç”ô—É–µ–∫–µ–ª' : '—Ä–∏—Å–∫'}</div><div style="font-size:13px;color:var(--muted)">${note}</div>`;
  tooltip.innerHTML = html;
  tooltip.classList.remove('show');
  // show after tiny delay to avoid flicker
  if(tooltipTimeout) clearTimeout(tooltipTimeout);
  tooltipTimeout = setTimeout(()=>{
    positionTooltip(e);
    tooltip.classList.add('show');
  }, 60);
}

function onMatrixCellMove(e){
  positionTooltip(e);
}

function onMatrixCellLeave(e){
  if(tooltipTimeout) clearTimeout(tooltipTimeout);
  tooltip.classList.remove('show');
  // clear after animation
  setTimeout(()=>{ tooltip.innerHTML = ''; }, 200);
}

function positionTooltip(e){
  const pad = 10;
  const viewportW = window.innerWidth;
  const viewportH = window.innerHeight;
  const tipRect = tooltip.getBoundingClientRect();
  const x = e.clientX;
  const y = e.clientY;
  // default above
  let left = x - tipRect.width/2;
  if(left < pad) left = pad;
  if(left + tipRect.width > viewportW - pad) left = viewportW - pad - tipRect.width;
  let top = e.clientY - tipRect.height - 12; // above cursor
  if(top < 10) top = e.clientY + 18; // if not enough space, place below
  tooltip.style.left = left + 'px';
  tooltip.style.top = top + 'px';
}

/* consequence datalist population */
function populateConsequenceDatalistForEnergy(energyKey){
  const dl = $('consequenceSuggestions'); 
  if(!dl) return; 
  dl.innerHTML='';
  const arr = (CONSEQUENCE_SUGGESTIONS_BY_ENERGY[energyKey] || []).concat(CONSEQUENCE_SUGGESTIONS_BY_ENERGY.default || []);
  Array.from(new Set(arr)).forEach(v=>{ 
    const opt=document.createElement('option'); 
    opt.value=v; 
    dl.appendChild(opt);
  } );
}

/* End of script */
</script>
</body>
</html>